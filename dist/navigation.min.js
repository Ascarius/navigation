!function(a,b,c,d){"use strict";function e(d){this.$window=a(b),this.$body=a(c.body),this.options=a.extend({},e.DEFAULTS,d),this.initialized=!1,this.states={},this.$contents={},a(a.proxy(this.init,this)),a(b).on("statechange",a.proxy(this.changed,this))}if(b.History&&History.enabled){e.DEFAULTS={navSelector:"#menu a",navActiveClass:"active",updateNav:d,contents:{main:{selector:"#main",create:"append",init:d,update:"fade",show:"fade",hide:"fade"}},debug:!1},e.prototype={log:function(){this.options.debug&&b.console&&"function"==typeof console.log&&console.log.apply(console,arguments)},init:function(){var d=this;d.log("init"),d.$body.on("click",d.options.navSelector,function(b){var c=a(b.currentTarget),e=c.attr("href");return b.shiftKey||b.ctrlKey||b.metaKey||2==b.which?!0:(c.is("a")&&(b.preventDefault(),d.change(e)),void 0)}),this.handler(b.location.href,c),this.initialized=!0,this.log("initialized")},change:function(b){this.initialized&&b!=this.getStateUrl()&&(this.log("change",b),this.$body.trigger("change.navigation",[b]),this.log("load",b),this.$body.trigger("load.navigation",[b]),a.ajax({url:b,dataType:"html",success:a.proxy(this.handler,this,b),error:a.proxy(this.error,this,b),complete:a.proxy(this.complete,this,b)}))},handler:function(a,b){var c=this.buildContents(b);this.log("handle",a),this[a==this.getStateUrl()?"replaceState":"pushState"](c,c.title,a)},error:function(a,b,c,d){this.log("error",arguments),this.$body.trigger("error.navigation",[a,b,c,d])},complete:function(a,b,c){this.log("loaded",a),this.$body.trigger("loaded.navigation",[a,b,c])},changed:function(){var a=this.getStateUrl();this.initialized&&(this.updateNav(),this.updateContents(),this.log("changed",a),this.$body.trigger("changed.navigation",[a]))},updateNav:function(b){var c,e=this.getStateUrl(),f=this.options;this.initialized&&(b=b||d,c=b===d?a(this.options.navSelector):a("a",b).filter(this.options.navSelector),"function"==typeof f.updateNav?f.updateNav.call(c,e):c.each(function(){var b=a(this);b.attr("href")==e?b.parent().addClass(f.navActiveClass):b.parent().removeClass(f.navActiveClass)}))},buildContents:function(b){var c,e=this,f=this.options,g={};if(b!==d){try{(c=a("title",b).html())?g.title=c:(c=b.match(/<title>(.*)<\/title>/i))&&(g.title=c[1])}catch(h){g.title=""}a.each(f.contents,function(c,d){var f="string"==typeof d?d:d.selector,h=e.getContentElement(c)||a(f),i=a(f,b);i.length&&(h.length||(h=e._createContent(c,d,i)),e._initContent(c,d,h),e.hasContentElement(c)||e.setContentElement(c,h),g[c]=i.html())})}return g},updateContents:function(){var b=this,d=this.options;this.initialized&&(this.log("update"),c.title=this.getStateDataValue("title"),a.each(d.contents,function(a,c){b.hasStateDataValue(a)?b._updateContent(a,c):b.hasContentElement(a)&&b._hideContent(a,c)}))},_createContent:function(b,c,e){var f,g,h=this,i=c.create!==d?c.create:"append",j=function(){h.log("created",b),e.trigger("created.navigation")};if(i)if(this.log("create",b),e.hide(),"function"==typeof i)i.call(e,b,c,j);else if(g=e.parent(),g.length&&(g.attr("id")?f=a("#"+g.attr("id")):g.is("body")&&($currentContent=a("body"))),f&&f.length)switch(i){case!0:case"append":f.append(e),j();break;case"prepend":f.prepend(e),j();break;default:throw new Error('Create method "'+i+'" is not valid')}else this.log("! no valid parent for "+b);return e},_initContent:function(a,b,c){var d=this,e=function(){d.log("initialized",a),c.trigger("initialized.navigation")};"function"==typeof b.init&&(d.log("initialize",a),b.init.call(c,a,b,e))},_updateContent:function(a,b){var c=this,e=b.update!==d?b.update:"fade",f=this.getStateDataValue(a),g=this.getContentElement(a),h=function(){c.log("updated",a),c.updateNav(g),g.trigger("updated.navigation")};if(e)if(this.log("update",a),g.trigger("update.navigation"),"function"==typeof e)e.call(g,f,a,b,h);else switch(e){case!0:case"fade":g.fadeTo(400,0,function(){g.html(f),g.fadeTo(400,1,h)});break;case"html":g.html(f),h();break;case"text":g.text(f),h();break;case"prepend":g.prepend(f),h();break;case"append":g.append(f),h();break;default:throw new Error('update method "'+e+'" is not supported')}this._showContent(a,b)},_showContent:function(a,b){var c=this,e=b.show!==d?b.show:"fade",f=this.getContentElement(a),g=function(){c.log("shown",a),f.trigger("shown.navigation")};if(f&&(this.log("show",a),f.trigger("show.navigation"),e))if("function"==typeof e)e.call(f,a,b,g);else switch(e){case!0:case"fade":f.fadeIn(g);break;case"show":f.show(),g();break;default:throw new Error('Show method "'+e+'" is not supported')}},_hideContent:function(a,b){var c=this,e=b.hide!==d?b.hide:"fade",f=this.getContentElement(a),g=function(){c.log("hidden",a),f.trigger("hidden.navigation")};if(f&&(this.log("hide",a),f.trigger("hide.navigation"),e))if("function"==typeof e)e.call(f,a,b,g);else switch(e){case!0:case"fade":f.fadeOut(g);break;case"hide":f.hide(),g();break;default:throw new Error('Hide method "'+e+'" is not supported')}},replaceState:function(a,b,c){History.replaceState(a,b,c)},pushState:function(a,b,c){History.pushState(a,b,c)},getStateUrl:function(){return History.getState().url},getStateData:function(){return History.getState().data||{}},getStateDataValue:function(a){return this.getStateData()[a]},hasStateDataValue:function(a){return this.getStateDataValue(a)!==d},setContentElement:function(a,b){return this.$contents[a]=b,this},getContentElement:function(a){return this.$contents[a]},hasContentElement:function(a){return this.$contents[a]!==d}};var f=a.navigation;a.navigation=function(b){var d=a(c.body),f=d.data("wxr.navigation"),g="object"==typeof b&&b;f||d.data("wxr.navigation",f=new e(g))},a.navigation.noConflict=function(){return a.navigation=f,this}}}(window.jQuery,window,document);