!function(a,b,c,d){"use strict";function e(b){this.options=a.extend({},e.DEFAULTS,b),this.initialized=!1,this.$contents={},this.discarded={},a(a.proxy(this.init,this))}if(b.History&&History.enabled){var f=a(b),g=a(c.body);e.DEFAULTS={navSelector:"#menu a",navActiveClass:"active",updateNav:d,contents:{main:{selector:"#main",create:"append",init:d,update:"fade",show:"fade",hide:"fade"}},debug:!1},e.prototype={log:function(){this.options.debug&&b.console&&"function"==typeof console.log&&console.log.apply(console,arguments)},init:function(){this.log("initialization"),f.on("statechange",a.proxy(this.changed,this)),g.on("click",this.options.navSelector,a.proxy(this.click,this)),this.handler(b.location.href,c),this.initialized=!0,this.log("initialized")},click:function(b){var c=a(b.currentTarget),d=c.attr("href");return b.shiftKey||b.ctrlKey||b.metaKey||2==b.which?!0:(c.is("a")&&(b.preventDefault(),this.change(d)),void 0)},change:function(b){this.initialized&&b!=this.getStateUrl()&&(this.log("change",b),g.trigger("change.navigation",[b]),this.log("load",b),g.trigger("load.navigation",[b]),a.ajax({url:b,dataType:"html",success:a.proxy(this.handler,this,b),error:a.proxy(this.error,this,b),complete:a.proxy(this.complete,this,b)}))},handler:function(a,b){var c;this.log("handle",a),c=this.buildContents(b),this[a==this.getStateUrl()?"replaceState":"pushState"](c,c.title,a)},error:function(a,b,c,d){this.log("error",arguments),g.trigger("error.navigation",[a,b,c,d])},complete:function(a,b,c){this.log("loaded",a),g.trigger("loaded.navigation",[a,b,c])},changed:function(){var a=this.getStateUrl();this.initialized&&(this.updateNav(),this.updateContents(),this.log("changed",a),g.trigger("changed.navigation",[a]))},updateNav:function(b){var c,e=this.getStateUrl(),f=this.options;b=b||d,c=b===d?a(this.options.navSelector):a("a",b).filter(this.options.navSelector),"function"==typeof f.updateNav?f.updateNav.call(c,e):c.each(function(){var b=a(this);b.attr("href")==e?b.parent().addClass(f.navActiveClass):b.parent().removeClass(f.navActiveClass)})},buildContents:function(b){var c,e=this,f=this.options,g={};if(b!==d){try{(c=a("title",b).html())?g.title=c:(c=b.match(/<title>(.*)<\/title>/i))&&(g.title=c[1])}catch(h){g.title=""}a.each(f.contents,function(c,d){var f="string"==typeof d?d:d.selector,h=e.getContentElement(c)||a(f),i=0!==h.length,j=a(f,b);j.length&&(i||(h=e._createContent(c,d,j),e.setContentDiscarded(c,!0)),i&&e.initialized||e._initContent(c,d,h),e.setContentElement(c,h),g[c]=j.html())})}return g},updateContents:function(){var b=this,d=this.options;this.log("update"),c.title=this.getStateDataValue("title"),a.each(d.contents,function(a,c){b.hasStateDataValue(a)?b._updateContent(a,c):b.hasContentElement(a)&&b._hideContent(a,c)})},_createContent:function(b,c,e){var f,h,i=this,j=c.create!==d?c.create:"append",k=function(){i.log("created",b),e.trigger("created.navigation")};if(j)if(this.log("create",b),"function"==typeof j)j.call(e,b,c,k);else if(h=e.parent(),h.length&&(h.attr("id")?f=a("#"+h.attr("id")):h.is("body")&&($currentContent=g)),f&&f.length)switch(j){case!0:case"append":f.append(e),k();break;case"prepend":f.prepend(e),k();break;default:throw new Error('Create method "'+j+'" is not valid')}else this.log("! no valid parent for "+b);return e},_initContent:function(a,b,c){var d=this,e=function(){d.log("initialized",a),c.trigger("initialized.navigation")};"function"==typeof b.init&&(d.log("initialize",a),b.init.call(c,a,b,e))},_updateContent:function(a,b){var c=this,e=b.update!==d?b.update:"fade",f=this.getStateDataValue(a),g=this.getContentElement(a),h=function(){c.log("updated",a),c.updateNav(g),g.trigger("updated.navigation")};if(e)if(this.isContentDiscarded(a))this.setContentDiscarded(a,!1);else if(this.log("update",a),g.trigger("update.navigation"),"function"==typeof e)e.call(g,f,a,b,h);else switch(e){case!0:case"fade":g.fadeTo(400,0,function(){g.html(f),g.fadeTo(400,1,h)});break;case"html":g.html(f),h();break;case"text":g.text(f),h();break;default:throw new Error('update method "'+e+'" is not supported')}else this._showContent(a,b)},_showContent:function(a,b){var c=this,e=b.show!==d?b.show:"fade",f=this.getContentElement(a),g=function(){c.log("shown",a),f.trigger("shown.navigation")};if(f&&(this.log("show",a),f.trigger("show.navigation"),e))if("function"==typeof e)e.call(f,a,b,g);else switch(e){case!0:case"fade":f.fadeIn(g);break;case"show":f.show(),g();break;default:throw new Error('Show method "'+e+'" is not supported')}},_hideContent:function(a,b){var c=this,e=b.hide!==d?b.hide:"fade",f=this.getContentElement(a),g=function(){c.log("hidden",a),f.trigger("hidden.navigation")};if(f&&(this.log("hide",a),f.trigger("hide.navigation"),e))if("function"==typeof e)e.call(f,a,b,g);else switch(e){case!0:case"fade":f.fadeOut(g);break;case"hide":f.hide(),g();break;default:throw new Error('Hide method "'+e+'" is not supported')}},replaceState:function(a,b,c){History.replaceState(a,b,c)},pushState:function(a,b,c){History.pushState(a,b,c)},getStateUrl:function(){return History.getState().url},getStateData:function(){return History.getState().data||{}},getStateDataValue:function(a){return this.getStateData()[a]},hasStateDataValue:function(a){return this.getStateDataValue(a)!==d},setContentElement:function(a,b){return this.$contents[a]=b,this},getContentElement:function(a){return this.$contents[a]},hasContentElement:function(a){return this.$contents[a]!==d},isContentDiscarded:function(a){return this.discarded[a]},setContentDiscarded:function(a,b){return this.discarded[a]=b,this}};var h=a.navigation;a.navigation=function(b){var d=a(c.body),f=d.data("wxr.navigation"),g="object"==typeof b&&b;f||d.data("wxr.navigation",f=new e(g))},a.navigation.Constructor=e,a.navigation.noConflict=function(){return a.navigation=h,this}}}(window.jQuery,window,document);