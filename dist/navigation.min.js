!function(a,b,c,d){"use strict";function e(d){this.$window=a(b),this.$body=a(c.body),this.options=a.extend({},e.DEFAULTS,d),this.initialized=!1,this.states={},this.$contents={},this.$title=a("title"),a(a.proxy(this.init,this)),a(b).on("statechange",a.proxy(this.change,this))}if(!b.History||!History.enabled)throw new Error("History.js is required");e.DEFAULTS={navSelector:"#menu a",navActiveClass:"active",updateNav:d,contents:{main:{selector:"#main",create:"append",update:"fade",show:"fade",hide:"fade"}},debug:!1},a.extend(e.prototype,{log:function(){this.options.debug&&b.console&&console.log.apply(console,arguments)},init:function(){var b=this,c=History.getState(),d=c.url;b.log("init"),b.$body.on("click",b.options.navSelector,function(b){var c=a(b.currentTarget),d=c.attr("href"),e=c.attr("title")||null;return b.shiftKey||b.ctrlKey||b.metaKey||2==b.which?!0:(c.is("a")&&(b.preventDefault(),History.pushState(null,e,d)),void 0)}),this.handler(d),this.initialized=!0,this.log("initialized")},change:function(){var b=History.getState(),c=b.url;this.log("change"),this.$body.trigger("change.navigation",c),this.hasState(c)?this.handler(c):(this.log("load",c),this.$body.trigger("load.navigation",c),a.ajax({url:c,dataType:"html",success:a.proxy(this.handler,this,c),error:a.proxy(this.error,this,c)}))},handler:function(a,b,d,e){this.log("handle",a),b?this.saveContents(a,b):this.initialized||this.saveContents(a,c),this.initialized&&(this.updateNav(a),this.updateContents(a)),e&&(this.log("loaded",a),this.$body.trigger("loaded.navigation",[a,b,d,e])),this.initialized&&(this.log("changed",a),this.$body.trigger("changed.navigation",[a,b,d,e]))},error:function(a,b,c,d){this.log("error",arguments),this.$body.trigger("error.navigation",[a,b,c,d])},updateNav:function(b,c){var e,f=this.options;this.initialized&&(c=c||d,e=c===d?a(this.options.navSelector):a("a",c).filter(this.options.navSelector),"function"==typeof f.updateNav?f.updateNav.call(e,b):e.each(function(){var c=a(this);c.attr("href")==b?c.parent().addClass(f.navActiveClass):c.parent().removeClass(f.navActiveClass)}))},saveContents:function(b,c){var e,f=this,g=this.options;this.log("save",b),c!==d&&((e=a("title",c).html())?this.setStateContent(b,"title",e):(e=c.match("<title>(.*)</title>"))&&this.setStateContent(b,"title",e[1]),a.each(g.contents,function(d,e){var g="string"==typeof e?e:e.selector,h=f.getContentElement(d)||a(g),i=a(g,c);i.length?(h.length||(h=f._createContent(d,e,i)),f._initContent(d,e,h),f.hasContentElement(d)||f.setContentElement(d,h),f.setStateContent(b,d,i.html())):f.log(b+" has no "+d)}))},updateContents:function(b){var c=this,d=this.options;this.log("update",b),this.$title.html(this.getStateContent(b,"title")),a.each(d.contents,function(a,d){c.hasStateContent(b,a)?c._updateContent(b,a,d):c.hasContentElement(a)&&c._hideContent(b,a,d)})},_createContent:function(b,c,e){var f,g,h=this,i=c.create!==d?c.create:"append",j=function(){h.log("created",b),e.trigger("created.navigation")};if(i)if(this.log("create",b),"function"==typeof i)i.call(e,b,c,j);else if(g=e.parent(),g.length&&(g.attr("id")?f=a("#"+g.attr("id")):g.is("body")&&($currentContent=a("body"))),f&&f.length)switch(i){case!0:case"append":f.append(e),j();break;case"prepend":f.prepend(e),j();break;default:throw new Error('Create method "'+i+'" is not valid')}else this.log("! no valid parent for "+b);return e},_initContent:function(a,b,c){var d=this,e=function(){d.log("initialized",a),c.trigger("initialized.navigation")};"function"==typeof b.init&&(d.log("initialize",a),b.init.call(c,a,b,e))},_updateContent:function(a,b,c){var e=this,f=c.update!==d?c.update:"fade",g=this.getStateContent(a,b),h=this.getContentElement(b),i=function(){e.log("updated",b),e.updateNav(a,h),h.trigger("updated.navigation")};if(f)if(this.log("update",a,b),"function"==typeof f)f.call(h,g,b,c,i);else switch(f){case!0:case"fade":h.fadeTo(400,0,function(){h.html(g),h.fadeTo(400,1,i)});break;case"html":h.html(g),i();break;case"text":h.text(g),i();break;case"prepend":h.prepend(g),i();break;case"append":h.append(g),i();break;default:throw new Error('update method "'+f+'" is not supported')}this._showContent(b,c)},_showContent:function(a,b){var c=this,e=b.show!==d?b.show:"fade",f=this.getContentElement(a),g=function(){c.log("shown",a),f.trigger("shown.navigation")};if(f&&(this.log("show",a),f.trigger("show.navigation"),e))if("function"==typeof e)e.call(f,a,b,g);else switch(e){case!0:case"fade":f.fadeIn(g);break;case"show":f.show(),g();break;default:throw new Error('Show method "'+e+'" is not supported')}},_hideContent:function(a,b,c){var e=this,f=c.hide!==d?c.hide:"fade",g=this.getContentElement(b),h=function(){e.log("hidden",b),g.trigger("hidden.navigation")};if(g&&(this.log("hide",b),g.trigger("hide.navigation"),f))if("function"==typeof f)f.call(g,b,c,h);else switch(f){case!0:case"fade":g.fadeOut(h);break;case"hide":g.hide(),h();break;default:throw new Error('Hide method "'+f+'" is not supported')}},setState:function(a,b){return this.states[a]=b,this},getState:function(a){return this.states[a]},hasState:function(a){return this.states[a]!==d},setStateContent:function(a,b,c){return this.states[a]===d&&(this.states[a]={}),this.states[a][b]=c,this},getStateContent:function(a,b){return this.states[a]?this.states[a][b]:d},hasStateContent:function(a,b){return this.states[a]!==d&&this.states[a][b]!==d},setContentElement:function(a,b){return this.$contents[a]=b,this},getContentElement:function(a){return this.$contents[a]},hasContentElement:function(a){return this.$contents[a]!==d}});var f=a.navigation;a.navigation=function(b){var d=a(c.body),f=d.data("wxr.navigation"),g="object"==typeof b&&b;f||d.data("wxr.navigation",f=new e(g))},a.navigation.noConflict=function(){return a.navigation=f,this}}(window.jQuery,window,window.document);